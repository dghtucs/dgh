


---

## 算法思路和实现要点

这道题要求在低维高数量（$n ≤ 10^5$，$q ≤ 2×10^5$）的实向量集合中，多次查询与给定点欧氏距离平方的最小值。采用 KD 树进行加速最近邻查询。

构建 KD 树时，按深度对维度取模作为划分轴，使用手写的快速选择（QuickSelect）算法在当前维度上选取中位数作为节点，为提高效率，叶子节点不只保存单点，而是保存一个小区间（bucket），减少树高和递归次数。

查询时，维护当前最优答案，通过“点到包围盒的最小可能距离”进行剪枝；若包围盒距离已不优于当前答案，则直接跳过子树。优先访问更可能包含最近点的子树，从而进一步提升剪枝效果。

---

## 渐进时间复杂度的分析，包含过程

构建 KD 树时，每一层通过 QuickSelect 在 O(n) 时间内选出中位数，树高期望为 $O(\log n)$，因此构建总时间复杂度为 $O(n \log n)$ 

对于单次查询，KD 树在均匀随机分布假设下，访问的节点数量为对数级，期望时间复杂度为 O(log n)；在叶节点中最多检查常数个点（bucket 大小固定），对复杂度影响可忽略。

因此，总查询时间复杂度为 O(q log n)，整体程序的期望时间复杂度为
$O(n \log n + q \log n)$。在最坏情况下可能达到 $O(n)$，但这道题目数据为均匀随机生成，满足 KD 树高效工作的前提。

---

## 渐进空间复杂度的分析，包含过程

除输入数据外，程序主要额外使用空间为 KD 树节点数组。每个节点存储：

* 一个点（常数维度 d ≤ 5）
* 一个包围盒（2d 个整数）
* 若干整数标记与子节点索引

节点数量与输入点数量同阶，为 O(n)。递归查询时，调用栈深度为树高，期望为 O(log n)，相较于节点存储可忽略。

因此，渐进空间复杂度为 O(n)

---

## 遇到的困难和解决方法

主要困难包括：



1. 查询数量大，暴力法超时：q 与 n 均较大，直接 O(nq) 不可行。
   → 解决方法：采用 KD 树，并通过包围盒剪枝显著减少搜索节点。

2. 递归过深或常数过大：单点叶子会导致树过深、查询慢。
   → 解决方法：在叶节点中保存多个点（bucket），平衡树高与局部暴力搜索成本。

3. IO 成为瓶颈：数据量较大。
   → 解决方法：使用 `getchar_unlocked` / `putchar_unlocked` 实现快速输入输出。

---

## 估计完成本题所用时间

约 3 小时

---

