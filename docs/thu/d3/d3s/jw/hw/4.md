
## 1）

交换机的逆向学习算法、生成树（STP）解决的主要是二层（数据链路层）的问题：在同一个二层广播域/同一 VLAN 内，学习 MAC 地址、避免二层环路，从而把帧正确转发。

而路由算法解决的是三层（网络层）跨网段转发的问题，核心差异：

* 作用范围不同：二层技术只管同一二层网络内的帧转发；路由要在多个 IP 子网之间选择路径并转发分组。
* 可扩展性不同：大型网络必须分层、分子网、做路由汇总；仅靠二层会导致广播域过大、管理困难。
* 策略与度量更丰富：路由可以按跳数、带宽、时延、管理策略等做选路；二层学习转发基本不涉及“最优路径”。
* 环路处理方式不同：二层常用 STP “砍掉链路”来避免环路；三层通过路由协议的收敛机制与度量计算来避免/消除环路影响，并能同时利用多条链路。

---

## 2）

### 2.1 采用的度量

距离向量题目通常默认度量为跳数

* 直连网段：度量取 (0)
* 经 1 条路由器链路到达：度量取 (1)

### 2.2 路由器 A 的路由表

| 目的地址          | 子网掩码            | 下一跳 | 度量值 |
| ------------- | --------------- | --- | --: |
| 192.168.0.0   | 255.255.255.0   | 直连  |   0 |
| 192.168.1.0   | 255.255.255.0   | D   |   1 |
| 10.1.0.0      | 255.255.0.0     | E   |   1 |
| 10.2.0.0      | 255.255.0.0     | E   |   2 |
| 192.168.1.128 | 255.255.255.128 | B   |   2 |

说明：

* 到 192.168.1.0/24：A→D（1 跳）
* 到 10.1.0.0/16：A→E（1 跳）
* 到 10.2.0.0/16：A→E→F（2 跳，比 A→B→C→F 的 3 跳更短）
* 到 192.168.1.128/25：A→B→C（2 跳）

### 2.3 A 对给定目的地址如何转发

1. 192.168.0.1
   命中 192.168.0.0/24 → 直连转发到 192.168.0.0/24 所在接口

2. 192.168.0.255
   仍命中 192.168.0.0/24 → 直连转发到该接口

3. 192.168.1.1
   命中 192.168.1.0/24 → 下一跳 D

4. 192.168.1.192
   同时匹配 192.168.1.0/24 与 192.168.1.128/25，按最长前缀匹配选 /25 → 下一跳 B

---

## 3）

### 3.1 度量定义

取一个方便的比例常数，使 10Gb/s 的链路代价为 1：

$
c = \frac{10}{B}
$
(B) 的单位为 Gb/s。

于是：

* 10Gb/s：$(c=\frac{10}{10}=1)$
* 2.5Gb/s：$(c=\frac{10}{2.5}=4)$

### 3.2 计算 A 到关键路由器的最短代价

* 到 C：A→B→C：(1+1=2)
* 到 F：

  * A→B→C→F：(1+1+1=3)
  * A→E→F：(1+4=5)
    所以选 A→B→C→F（代价 3）

### 3.3 路由器 A 的路由表

| 目的地址          | 子网掩码            | 下一跳 | 度量值 |
| ------------- | --------------- | --- | --: |
| 192.168.0.0   | 255.255.255.0   | 直连  |   0 |
| 192.168.1.0   | 255.255.255.0   | D   |   1 |
| 10.1.0.0      | 255.255.0.0     | E   |   1 |
| 10.2.0.0      | 255.255.0.0     | B   |   3 |
| 192.168.1.128 | 255.255.255.128 | B   |   2 |

对比第 2 题的差异：

* 10.2.0.0/16 的下一跳从 E 变为 B，因为链路状态按“带宽反比”计费后，2.5Gb/s 的 E–F 链路代价更高。



## 6）

即使传送层（如 TCP）能通过端到端控制发送速率，也仍然需要网络层拥塞控制，主要原因是：

1. 并非所有业务都能依赖传送层控制
   传送层速率控制主要对 TCP 这类“响应式”流量有效；但网络里还有大量 UDP/实时流/不按拥塞退让的应用，只靠传送层无法约束它们，必须由网络层（路由器/网关）在瓶颈处进行控制与保护。

2. 拥塞发生在网络内部，端系统看到的是“结果”而非“原因”
   端到端只能从丢包、RTT 变大推测拥塞，反馈滞后且不精确；而网络层位于拥塞点（队列/链路），能更直接地做：

   * 主动队列管理（如提前丢弃/标记）
   * 显式拥塞通知（ECN）
   * 调度与整形（公平排队、优先级等）

3. 需要在共享资源处做公平性与隔离
   多流共享同一瓶颈时，若只靠端系统自觉退让，容易出现不公平甚至“劣币驱逐良币”。网络层可实现：

   * 对不同流/不同业务的公平分配
   * 对异常/攻击流量的隔离与限速
   * 防止拥塞崩溃（大量重传进一步加剧拥塞）

4. 网络层还能做“准入控制/资源管理”
   有些场景需要在网络内部保证服务质量（QoS），例如对某类业务限制进入、预留资源等，这属于网络层的职责。

---

## 8）

已知：

* 桶容量 $(C=1000\text{ MB})$（本题中不成为瓶颈，因为初始令牌 450MB < 1000MB）
* 令牌产生速率 $(r=5\text{ MB/s})$
* 初始令牌 $(T_0=450\text{ MB})$
* 发送速率 $(s=20\text{ MB/s})$
* 数据量 $(D=2000\text{ MB})$
* 
### 阶段 1：有令牌时按 $(20\text{ MB/s})$ 发送

令牌净消耗速率：
$$
s-r=20-5=15\ \text{MB/s}
$$
令牌耗尽时间：
$$
t_1=\frac{T_0}{s-r}=\frac{450}{15}=30\ \text{s}
$$
这段时间发送数据量：
$$
D_1=s\cdot t_1=20\times 30=600\ \text{MB}
$$

### 阶段 2：令牌用尽后只能按产生速率发送

剩余数据：
$$
D_2=D-D_1=2000-600=1400\ \text{MB}
$$
此时可持续发送速率为 $(r=5\text{ MB/s})$，所需时间：
$$
t_2=\frac{D_2}{r}=\frac{1400}{5}=280\ \text{s}
$$

### 总时间

$$
t=t_1+t_2=30+280=310\ \text{s}=5\ \text{min}\ 10\ \text{s}
$$

---

## 10）

三层层次下，常见路由表规模估算为：

* 对本组内目的：需要到本组其他节点的明细项 ((G-1))
* 对本区域内其他组：按“组”为单位汇总 ((K-1))
* 对其他区域：按“区域”为单位汇总 ((R-1))

因此每个节点路由表项数近似：
$$
T=(G-1)+(K-1)+(R-1)=G+K+R-3
$$
同时满足：
$$
R\cdot K\cdot G=4800,\quad T\le 50
$$

给出一种可行划分方案：

* 划分为 (R=15) 个区域
* 每个区域 (K=16) 个组
* 每个组 (G=20) 个节点

验证节点总数：
$$
15\times 16\times 20=4800
$$

验证路由表项数：
$$
T=(20-1)+(16-1)+(15-1)=19+15+14=48\le 50
$$






## 12）

已知：MTU 指每个 IP 分片（含首部）在链路上传输的最大长度。

---

## 一、IPv4

* IPv4 每个分片都要带 20B 首部
  $$
  \text{每片最大数据} = 500-20=480\text{ B}
  $$
* IPv4 分片偏移以 8B 为单位，因此除最后一片外数据长度必须是 8 的倍数。
  (480) 正好是 (8) 的倍数。

把载荷 (1480) 按 (480) 切分：
$$
1480 = 480\times 3 + 40
$$
所以需要 4 个片段。

### 分片结果（数据字段长度 / 总长度 / 片偏移 / MF）

| 片号 | 数据长度(B) | 该片总长度(B) | Fragment Offset | MF |
| -- | ------: | -------: | --------------: | -: |
| 1  |     480 |      500 |             (0) |  1 |
| 2  |     480 |      500 |      (480/8=60) |  1 |
| 3  |     480 |      500 |     (960/8=120) |  1 |
| 4  |      40 |       60 |    (1440/8=180) |  0 |

答案（IPv4）：4 片。

---

## 二、IPv6



### 1）不含扩展头部（只算 40B 基本首部）

$$
\text{每片最大数据} = 500-40=460\text{ B}
$$
分片偏移同样以 8B 为单位，除最后一片外取不超过 460 的最大 8 倍数：
$$
\lfloor 460/8\rfloor \times 8 = 57\times 8 = 456\text{ B}
$$
$$
1480 = 456\times 3 + 112
$$
因此需要 4 个片段（数据分别 456,456,456,112）。

答案：4 片。










## 15）NAT 地址转换（用五元组表示）

表 6.16（NAT 映射表）给出：

* (192.168.1.44:5001) / TCP  ($\leftrightarrow$)  (166.111.68.231:10044) / TCP
* (192.168.1.45:6000) / UDP  ($\leftrightarrow$)  (166.111.68.231:10044) / UDP
* (192.168.1.46:5001) / TCP  ($\leftrightarrow$)  (166.111.68.231:10045) / TCP

五元组格式：$$(\text{源IP},\ \text{目的IP},\ \text{源端口},\ \text{目的端口},\ \text{协议})$$

---

### (1) 收到分组

查表：(192.168.1.44:5001/TCP $\rightarrow$ 166.111.68.231:10044/TCP)

转换后五元组：
$$
(166.111.68.231,\ 168.111.4.98,\ 10044,\ 80,\ TCP)
$$

---

### (2) 收到分组

查表：(192.168.1.46:5001/TCP $\rightarrow$ 166.111.68.231:10045/TCP)

转换后五元组：
$$
(166.111.68.231,\ 168.111.4.98,\ 10045,\ 80,\ TCP)
$$

---

### (3) 收到分组

这是外网到 NAT 的分组，需把 目的IP/目的端口 反向映射。

查表：(166.111.68.231:10044/UDP $\rightarrow$ 192.168.1.45:6000/UDP)
转换后五元组：
$$
(166.111.8.28,\ 192.168.1.45,\ 53,\ 6000,\ UDP)
$$

---

### (4)

这是静态端口映射，应添加一条表项：

| 内部IP地址       | 内部端口号 | 协议  | 外部IP地址         | 外部端口号 |
| ------------ | ----: | --- | -------------- | ----: |
| 192.168.1.46 |    80 | TCP | 166.111.68.232 |  8080 |
























