

Q1

1.

语句 11 ：
开作用域有两个：
全局作用域（含符号 a0, b0, a2, foo）
foo 作用域（含符号a1, b1, bar）

语句 16 ：
开作用域有两个：
全局作用域（含符号 a0, b0, a2, foo, baz）
baz 作用域（含符号 a3）


分析至语句 16 时，访问的 a2 是在第 1 行语句声明的


2.
语句 11 ：
开作用域有两个：
全局作用域（含符号 a0, b0, a2, foo, baz）
foo 作用域（含符号 a1, b1, bar）

至语句 16 时，开作用域有两个：
全局作用域（含符号 a0, b0, a2, foo,baz）
baz 作用域（含符号 a3）



Q2

1.
![alt text](image.png)

2.

S → A { print(A.x) }

A → B { R.i := B.x } R { A.x := R.s }

R → a B { R1.i := R.i + B.x } R1 { R.s := R1.s }

R → ε { R.s := R.i }

B → b A { B.x := A.x + 1 }

B → c { B.x = 0 }



3.

```c
int parseR(int R_i) {
    int R1_i;
    switch (lookahead) {
        case 'a':
            matchToken('a');
            R1_i = R_i + parseB();
            return parseR(R1_i);
        case '#':
            return R_i;
        default:
            printf("syntax error\n");
            exit(1);
    }
}

```

Q3

1.

D 的两个产生式需要变换，因为L 的继承属性无法确定地从栈上得到

变换后的翻译模式：

\( S \rightarrow D \{ \mathrm{print}(D.width) \} \)

\( D \rightarrow D_1 ; T 
\;\{ L.type := T.type;\; L.offset := D_1.width;\; L.width := T.width \}\; L \\
\quad\{ D.width := D_1.width + L.num \times T.width \} \)

\( D \rightarrow M N T
\;\{ L.type := T.type;\; L.offset := M.width;\; L.width := T.width \}\; L \\
\quad\{ D.width := L.num \times T.width \} \)

\( T \rightarrow int \{ T.type := 'int';\; T.width := 4 \} \)

\( T \rightarrow real \{ T.type := 'real';\; T.width := 8 \} \)

\( L \rightarrow 
\;\{ L_1.type := L.type;\; L_1.offset := L.offset;\; L_1.width := L.width \}\; L_1, id \\
\quad\{ foo(id.name,\; L.type,\; L.offset + L_1.num \times L_1.width);\; L.num := L_1.num + 1 \} \)

\( L \rightarrow id 
\;\{ foo(id.name,\; L.type,\; L.offset);\; L.num := 1 \} \)

\( M \rightarrow \epsilon \{ M.width := 0 \} \)

\( N \rightarrow \epsilon \)



2.

```math
\begin{aligned}
S &\to D \ \{\, \text{print}(v[\text{top}].\text{width}) \,\} \\[4pt]
D &\to D_1 \,;\, T\,L 
\ \{\, v[\text{top}-3].\text{width} := v[\text{top}-3].\text{width} + v[\text{top}].\text{num}\cdot v[\text{top}-1].\text{width} \,\} \\[4pt]
D &\to M\,N\,T\,L 
\ \{\, v[\text{top}-3].\text{width} := v[\text{top}].\text{num}\cdot v[\text{top}-1].\text{width} \,\} \\[4pt]
T &\to \textit{int} 
\ \{\, v[\text{top}].\text{type} := \text{'int'};\ v[\text{top}].\text{width} := 4 \,\} \\[4pt]
T &\to \textit{real} 
\ \{\, v[\text{top}].\text{type} := \text{'real'};\ v[\text{top}].\text{width} := 8 \,\} \\[6pt]
L &\to L_1,\, id \\
&\quad \{\, 
\text{foo}(v[\text{top}].\text{name},\ v[\text{top}-3].\text{type},\ v[\text{top}-5].\text{width}+v[\text{top}-2].\text{num}\cdot v[\text{top}-3].\text{width}); \\
&\qquad\ \ v[\text{top}-2].\text{num} := v[\text{top}-2].\text{num}+1
\,\} \\[6pt]
L &\to id 
\ \{\, \text{foo}(v[\text{top}].\text{name},\ v[\text{top}-1].\text{type},\ v[\text{top}-3].\text{width});\ v[\text{top}].\text{num} := 1 \,\} \\[6pt]
M &\to \epsilon 
\ \{\, v[\text{top}+1].\text{width} := 0 \,\} \\[4pt]
N &\to \epsilon \ \{\, \,\}
\end{aligned}
```




3.
打印 8

































