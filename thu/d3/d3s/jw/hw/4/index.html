<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../../../img/favicon.ico">
        <title>4 - 勿怯 勿惰 勿贪 勿我</title>
        <link href="../../../../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../../../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../../../../../css/brands.min.css" rel="stylesheet">
        <link href="../../../../../../css/solid.min.css" rel="stylesheet">
        <link href="../../../../../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../../../../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../../../../..">勿怯 勿惰 勿贪 勿我</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../../../../../.." class="nav-link">个人首页</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../../../../../about/" class="nav-link">工具链接网址</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">清华</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../../thu/" class="dropdown-item">清华</a>
</li>
                                    
<li>
    <a href="../../../../../d1/d1/" class="dropdown-item">大一</a>
</li>
                                    
<li>
    <a href="../../../../../d2/d2/" class="dropdown-item">大二</a>
</li>
                                    
<li>
    <a href="../../../../d3/" class="dropdown-item">大三</a>
</li>
                                    
<li>
    <a href="../../../../../d4/d4/" class="dropdown-item">大四</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">数学</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../../../math/math/" class="dropdown-item">数学</a>
</li>
                                    
<li>
    <a href="../../../../../../math/caculus/" class="dropdown-item">微积分</a>
</li>
                                    
<li>
    <a href="../../../../../../math/linear/" class="dropdown-item">线性代数</a>
</li>
                                    
<li>
    <a href="../../../../../../math/probability/" class="dropdown-item">概率论</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">计算机</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../../../cs/cs/" class="dropdown-item">计算机</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">编程语言</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">C语言</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../../../cs/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/c/c/" class="dropdown-item">C</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">C++语言</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../../../cs/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/cpp/cpp/" class="dropdown-item">C++</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">数据结构</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../../../cs/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/dsa/" class="dropdown-item">总述</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">操作系统</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../../../cs/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/os/" class="dropdown-item">总述</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">计算机组成原理</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../../../cs/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/jz/" class="dropdown-item">总述</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">计算机网络</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../../../cs/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/jw/" class="dropdown-item">总述</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">金融量化</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../../../finance/finance/" class="dropdown-item">金融</a>
</li>
                                    
<li>
    <a href="../../../../../../finance/crypto/crypto/" class="dropdown-item">币</a>
</li>
                                    
<li>
    <a href="../../../../../../finance/stock/stock/" class="dropdown-item">股票</a>
</li>
                                    
<li>
    <a href="../../../../../../finance/quant/quant/" class="dropdown-item">量化</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">艺体</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../../../art/art/" class="dropdown-item">文学</a>
</li>
                                    
<li>
    <a href="../../../../../../art/English/english/" class="dropdown-item">英语</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">读书</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">计算机</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../../../books/cs/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/lan/" class="dropdown-item">编程语言</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="../../../../../../books/%E4%B8%AA%E4%BA%BA%E6%88%90%E9%95%BF/gr/" class="dropdown-item">个人成长</a>
</li>
            
<li>
    <a href="../../../../../../books/navy/zashu/" class="dropdown-item">杂书</a>
</li>
    </ul>
  </li>
                                    
<li>
    <a href="../../../../../../art/music/" class="dropdown-item">音乐</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">生活记录</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../../../me/dgh/" class="dropdown-item">我是谁</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">2024</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../../../me/2024/2024/" class="dropdown-item">2024年</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">8月</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../../../me/2024/8/2024%E5%B9%B48%E6%9C%886%E6%97%A5/" class="dropdown-item">2024年8月6日</a>
</li>
            
<li>
    <a href="../../../../../../me/2024/8/2024%E5%B9%B48%E6%9C%887%E6%97%A5/" class="dropdown-item">2024年8月7日</a>
</li>
            
<li>
    <a href="../../../../../../me/2024/8/2024%E5%B9%B48%E6%9C%888%E6%97%A5/" class="dropdown-item">2024年8月8日</a>
</li>
            
<li>
    <a href="../../../../../../me/2024/8/2024%E5%B9%B48%E6%9C%889%E6%97%A5/" class="dropdown-item">2024年8月9日</a>
</li>
            
<li>
    <a href="../../../../../../me/2024/8/2024%E5%B9%B48%E6%9C%8810%E6%97%A5/" class="dropdown-item">2024年8月10日</a>
</li>
            
<li>
    <a href="../../../../../../me/2024/8/2024%E5%B9%B48%E6%9C%8811%E6%97%A5/" class="dropdown-item">2024年8月11日</a>
</li>
            
<li>
    <a href="../../../../../../me/2024/8/2024%E5%B9%B48%E6%9C%8812%E6%97%A5/" class="dropdown-item">2024年8月12日</a>
</li>
            
<li>
    <a href="../../../../../../me/2024/8/2024%E5%B9%B48%E6%9C%8813%E6%97%A5/" class="dropdown-item">2024年8月13日</a>
</li>
            
<li>
    <a href="../../../../../../me/2024/8/2024%E5%B9%B48%E6%9C%8814%E6%97%A5/" class="dropdown-item">2024年8月14日</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">11月</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../../../me/2024/11/2024%E5%B9%B411%E6%9C%8828%E6%97%A5/" class="dropdown-item">2024年11月28日</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">2025</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../../../me/2025/2025%E5%B9%B4/" class="dropdown-item">2025年</a>
</li>
            
<li>
    <a href="../../../../../../me/2025/1%E6%9C%88/2025%E5%B9%B41%E6%9C%88/" class="dropdown-item">2025年1月</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="2"><a href="#1" class="nav-link">1）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#2" class="nav-link">2）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#3" class="nav-link">3）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#6" class="nav-link">6）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#8" class="nav-link">8）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#10" class="nav-link">10）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#12" class="nav-link">12）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#ipv4" class="nav-link">一、IPv4</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#ipv6" class="nav-link">二、IPv6</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#15nat" class="nav-link">15）NAT 地址转换（用五元组表示）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="1">1）</h2>
<p>交换机的逆向学习算法、生成树（STP）解决的主要是二层（数据链路层）的问题：在同一个二层广播域/同一 VLAN 内，学习 MAC 地址、避免二层环路，从而把帧正确转发。</p>
<p>而路由算法解决的是三层（网络层）跨网段转发的问题，核心差异：</p>
<ul>
<li>作用范围不同：二层技术只管同一二层网络内的帧转发；路由要在多个 IP 子网之间选择路径并转发分组。</li>
<li>可扩展性不同：大型网络必须分层、分子网、做路由汇总；仅靠二层会导致广播域过大、管理困难。</li>
<li>策略与度量更丰富：路由可以按跳数、带宽、时延、管理策略等做选路；二层学习转发基本不涉及“最优路径”。</li>
<li>环路处理方式不同：二层常用 STP “砍掉链路”来避免环路；三层通过路由协议的收敛机制与度量计算来避免/消除环路影响，并能同时利用多条链路。</li>
</ul>
<hr />
<h2 id="2">2）</h2>
<h3 id="21">2.1 采用的度量</h3>
<p>距离向量题目通常默认度量为跳数</p>
<ul>
<li>直连网段：度量取 (0)</li>
<li>经 1 条路由器链路到达：度量取 (1)</li>
</ul>
<h3 id="22-a">2.2 路由器 A 的路由表</h3>
<table>
<thead>
<tr>
<th>目的地址</th>
<th>子网掩码</th>
<th>下一跳</th>
<th style="text-align: right;">度量值</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.0.0</td>
<td>255.255.255.0</td>
<td>直连</td>
<td style="text-align: right;">0</td>
</tr>
<tr>
<td>192.168.1.0</td>
<td>255.255.255.0</td>
<td>D</td>
<td style="text-align: right;">1</td>
</tr>
<tr>
<td>10.1.0.0</td>
<td>255.255.0.0</td>
<td>E</td>
<td style="text-align: right;">1</td>
</tr>
<tr>
<td>10.2.0.0</td>
<td>255.255.0.0</td>
<td>E</td>
<td style="text-align: right;">2</td>
</tr>
<tr>
<td>192.168.1.128</td>
<td>255.255.255.128</td>
<td>B</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
<p>说明：</p>
<ul>
<li>到 192.168.1.0/24：A→D（1 跳）</li>
<li>到 10.1.0.0/16：A→E（1 跳）</li>
<li>到 10.2.0.0/16：A→E→F（2 跳，比 A→B→C→F 的 3 跳更短）</li>
<li>到 192.168.1.128/25：A→B→C（2 跳）</li>
</ul>
<h3 id="23-a">2.3 A 对给定目的地址如何转发</h3>
<ol>
<li>
<p>192.168.0.1
   命中 192.168.0.0/24 → 直连转发到 192.168.0.0/24 所在接口</p>
</li>
<li>
<p>192.168.0.255
   仍命中 192.168.0.0/24 → 直连转发到该接口</p>
</li>
<li>
<p>192.168.1.1
   命中 192.168.1.0/24 → 下一跳 D</p>
</li>
<li>
<p>192.168.1.192
   同时匹配 192.168.1.0/24 与 192.168.1.128/25，按最长前缀匹配选 /25 → 下一跳 B</p>
</li>
</ol>
<hr />
<h2 id="3">3）</h2>
<h3 id="31">3.1 度量定义</h3>
<p>取一个方便的比例常数，使 10Gb/s 的链路代价为 1：</p>
<p>$
c = \frac{10}{B}
$
(B) 的单位为 Gb/s。</p>
<p>于是：</p>
<ul>
<li>10Gb/s：$(c=\frac{10}{10}=1)$</li>
<li>2.5Gb/s：$(c=\frac{10}{2.5}=4)$</li>
</ul>
<h3 id="32-a">3.2 计算 A 到关键路由器的最短代价</h3>
<ul>
<li>到 C：A→B→C：(1+1=2)</li>
<li>
<p>到 F：</p>
</li>
<li>
<p>A→B→C→F：(1+1+1=3)</p>
</li>
<li>A→E→F：(1+4=5)
    所以选 A→B→C→F（代价 3）</li>
</ul>
<h3 id="33-a">3.3 路由器 A 的路由表</h3>
<table>
<thead>
<tr>
<th>目的地址</th>
<th>子网掩码</th>
<th>下一跳</th>
<th style="text-align: right;">度量值</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.0.0</td>
<td>255.255.255.0</td>
<td>直连</td>
<td style="text-align: right;">0</td>
</tr>
<tr>
<td>192.168.1.0</td>
<td>255.255.255.0</td>
<td>D</td>
<td style="text-align: right;">1</td>
</tr>
<tr>
<td>10.1.0.0</td>
<td>255.255.0.0</td>
<td>E</td>
<td style="text-align: right;">1</td>
</tr>
<tr>
<td>10.2.0.0</td>
<td>255.255.0.0</td>
<td>B</td>
<td style="text-align: right;">3</td>
</tr>
<tr>
<td>192.168.1.128</td>
<td>255.255.255.128</td>
<td>B</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
<p>对比第 2 题的差异：</p>
<ul>
<li>10.2.0.0/16 的下一跳从 E 变为 B，因为链路状态按“带宽反比”计费后，2.5Gb/s 的 E–F 链路代价更高。</li>
</ul>
<h2 id="6">6）</h2>
<p>即使传送层（如 TCP）能通过端到端控制发送速率，也仍然需要网络层拥塞控制，主要原因是：</p>
<ol>
<li>
<p>并非所有业务都能依赖传送层控制
   传送层速率控制主要对 TCP 这类“响应式”流量有效；但网络里还有大量 UDP/实时流/不按拥塞退让的应用，只靠传送层无法约束它们，必须由网络层（路由器/网关）在瓶颈处进行控制与保护。</p>
</li>
<li>
<p>拥塞发生在网络内部，端系统看到的是“结果”而非“原因”
   端到端只能从丢包、RTT 变大推测拥塞，反馈滞后且不精确；而网络层位于拥塞点（队列/链路），能更直接地做：</p>
</li>
<li>
<p>主动队列管理（如提前丢弃/标记）</p>
</li>
<li>显式拥塞通知（ECN）</li>
<li>
<p>调度与整形（公平排队、优先级等）</p>
</li>
<li>
<p>需要在共享资源处做公平性与隔离
   多流共享同一瓶颈时，若只靠端系统自觉退让，容易出现不公平甚至“劣币驱逐良币”。网络层可实现：</p>
</li>
<li>
<p>对不同流/不同业务的公平分配</p>
</li>
<li>对异常/攻击流量的隔离与限速</li>
<li>
<p>防止拥塞崩溃（大量重传进一步加剧拥塞）</p>
</li>
<li>
<p>网络层还能做“准入控制/资源管理”
   有些场景需要在网络内部保证服务质量（QoS），例如对某类业务限制进入、预留资源等，这属于网络层的职责。</p>
</li>
</ol>
<hr />
<h2 id="8">8）</h2>
<p>已知：</p>
<ul>
<li>桶容量 $(C=1000\text{ MB})$（本题中不成为瓶颈，因为初始令牌 450MB &lt; 1000MB）</li>
<li>令牌产生速率 $(r=5\text{ MB/s})$</li>
<li>初始令牌 $(T_0=450\text{ MB})$</li>
<li>发送速率 $(s=20\text{ MB/s})$</li>
<li>数据量 $(D=2000\text{ MB})$</li>
<li></li>
</ul>
<h3 id="1-20text-mbs">阶段 1：有令牌时按 $(20\text{ MB/s})$ 发送</h3>
<p>令牌净消耗速率：
$$
s-r=20-5=15\ \text{MB/s}
$$
令牌耗尽时间：
$$
t_1=\frac{T_0}{s-r}=\frac{450}{15}=30\ \text{s}
$$
这段时间发送数据量：
$$
D_1=s\cdot t_1=20\times 30=600\ \text{MB}
$$</p>
<h3 id="2_1">阶段 2：令牌用尽后只能按产生速率发送</h3>
<p>剩余数据：
$$
D_2=D-D_1=2000-600=1400\ \text{MB}
$$
此时可持续发送速率为 $(r=5\text{ MB/s})$，所需时间：
$$
t_2=\frac{D_2}{r}=\frac{1400}{5}=280\ \text{s}
$$</p>
<h3 id="_1">总时间</h3>
<p>$$
t=t_1+t_2=30+280=310\ \text{s}=5\ \text{min}\ 10\ \text{s}
$$</p>
<hr />
<h2 id="10">10）</h2>
<p>三层层次下，常见路由表规模估算为：</p>
<ul>
<li>对本组内目的：需要到本组其他节点的明细项 ((G-1))</li>
<li>对本区域内其他组：按“组”为单位汇总 ((K-1))</li>
<li>对其他区域：按“区域”为单位汇总 ((R-1))</li>
</ul>
<p>因此每个节点路由表项数近似：
$$
T=(G-1)+(K-1)+(R-1)=G+K+R-3
$$
同时满足：
$$
R\cdot K\cdot G=4800,\quad T\le 50
$$</p>
<p>给出一种可行划分方案：</p>
<ul>
<li>划分为 (R=15) 个区域</li>
<li>每个区域 (K=16) 个组</li>
<li>每个组 (G=20) 个节点</li>
</ul>
<p>验证节点总数：
$$
15\times 16\times 20=4800
$$</p>
<p>验证路由表项数：
$$
T=(20-1)+(16-1)+(15-1)=19+15+14=48\le 50
$$</p>
<h2 id="12">12）</h2>
<p>已知：MTU 指每个 IP 分片（含首部）在链路上传输的最大长度。</p>
<hr />
<h2 id="ipv4">一、IPv4</h2>
<ul>
<li>IPv4 每个分片都要带 20B 首部
  $$
  \text{每片最大数据} = 500-20=480\text{ B}
  $$</li>
<li>IPv4 分片偏移以 8B 为单位，因此除最后一片外数据长度必须是 8 的倍数。
  (480) 正好是 (8) 的倍数。</li>
</ul>
<p>把载荷 (1480) 按 (480) 切分：
$$
1480 = 480\times 3 + 40
$$
所以需要 4 个片段。</p>
<h3 id="mf">分片结果（数据字段长度 / 总长度 / 片偏移 / MF）</h3>
<table>
<thead>
<tr>
<th>片号</th>
<th style="text-align: right;">数据长度(B)</th>
<th style="text-align: right;">该片总长度(B)</th>
<th style="text-align: right;">Fragment Offset</th>
<th style="text-align: right;">MF</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td style="text-align: right;">480</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">(0)</td>
<td style="text-align: right;">1</td>
</tr>
<tr>
<td>2</td>
<td style="text-align: right;">480</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">(480/8=60)</td>
<td style="text-align: right;">1</td>
</tr>
<tr>
<td>3</td>
<td style="text-align: right;">480</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">(960/8=120)</td>
<td style="text-align: right;">1</td>
</tr>
<tr>
<td>4</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">(1440/8=180)</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p>答案（IPv4）：4 片。</p>
<hr />
<h2 id="ipv6">二、IPv6</h2>
<h3 id="1-40b">1）不含扩展头部（只算 40B 基本首部）</h3>
<p>$$
\text{每片最大数据} = 500-40=460\text{ B}
$$
分片偏移同样以 8B 为单位，除最后一片外取不超过 460 的最大 8 倍数：
$$
\lfloor 460/8\rfloor \times 8 = 57\times 8 = 456\text{ B}
$$
$$
1480 = 456\times 3 + 112
$$
因此需要 4 个片段（数据分别 456,456,456,112）。</p>
<p>答案：4 片。</p>
<h2 id="15nat">15）NAT 地址转换（用五元组表示）</h2>
<p>表 6.16（NAT 映射表）给出：</p>
<ul>
<li>(192.168.1.44:5001) / TCP  ($\leftrightarrow$)  (166.111.68.231:10044) / TCP</li>
<li>(192.168.1.45:6000) / UDP  ($\leftrightarrow$)  (166.111.68.231:10044) / UDP</li>
<li>(192.168.1.46:5001) / TCP  ($\leftrightarrow$)  (166.111.68.231:10045) / TCP</li>
</ul>
<p>五元组格式：$$(\text{源IP},\ \text{目的IP},\ \text{源端口},\ \text{目的端口},\ \text{协议})$$</p>
<hr />
<h3 id="1_1">(1) 收到分组</h3>
<p>查表：(192.168.1.44:5001/TCP $\rightarrow$ 166.111.68.231:10044/TCP)</p>
<p>转换后五元组：
$$
(166.111.68.231,\ 168.111.4.98,\ 10044,\ 80,\ TCP)
$$</p>
<hr />
<h3 id="2_2">(2) 收到分组</h3>
<p>查表：(192.168.1.46:5001/TCP $\rightarrow$ 166.111.68.231:10045/TCP)</p>
<p>转换后五元组：
$$
(166.111.68.231,\ 168.111.4.98,\ 10045,\ 80,\ TCP)
$$</p>
<hr />
<h3 id="3_1">(3) 收到分组</h3>
<p>这是外网到 NAT 的分组，需把 目的IP/目的端口 反向映射。</p>
<p>查表：(166.111.68.231:10044/UDP $\rightarrow$ 192.168.1.45:6000/UDP)
转换后五元组：
$$
(166.111.8.28,\ 192.168.1.45,\ 53,\ 6000,\ UDP)
$$</p>
<hr />
<h3 id="4">(4)</h3>
<p>这是静态端口映射，应添加一条表项：</p>
<table>
<thead>
<tr>
<th>内部IP地址</th>
<th style="text-align: right;">内部端口号</th>
<th>协议</th>
<th>外部IP地址</th>
<th style="text-align: right;">外部端口号</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.1.46</td>
<td style="text-align: right;">80</td>
<td>TCP</td>
<td>166.111.68.232</td>
<td style="text-align: right;">8080</td>
</tr>
</tbody>
</table></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../../../../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../../../../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../../../../js/base.js"></script>
        <script src="../../../../../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
